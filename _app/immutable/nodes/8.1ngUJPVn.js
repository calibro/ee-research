import{s as Z,c as j,f as z}from"../chunks/scheduler.xAzB39Af.js";import{S as x,i as ee,e as A,m as D,s as J,c as M,a as N,n as L,f as K,d as $,o as O,g as S,p as U,h as T,k as _,l as y,x as Q,q as I,y as w,z as R}from"../chunks/index.Byt9v-am.js";import{e as V,u as te,o as re}from"../chunks/each.Bv90klXA.js";import{S as se,q as B,g as le,a as ae,b as oe}from"../chunks/index.DVmt29A5.js";import{l as P,g as ie,c as ne}from"../chunks/download.BqV-rfyR.js";import{d as ce,C as ue}from"../chunks/circlePacking.B900PBM5.js";import{L as fe}from"../chunks/link.hHwDy82e.js";import{b as pe}from"../chunks/paths.CDNubtT_.js";function F(n,t,a){const i=n.slice();return i[16]=t[a],i[18]=a,i}function G(n){let t=[],a=new Map,i,r,o=V(n[4]);const l=e=>{var s;return`${e[1]}-${e[2]}-${e[18]}-${(s=e[16])==null?void 0:s[0]}`};for(let e=0;e<o.length;e+=1){let s=F(n,o,e),c=l(s);a.set(c,t[e]=H(c,s))}return{c(){for(let e=0;e<t.length;e+=1)t[e].c();i=w()},l(e){for(let s=0;s<t.length;s+=1)t[s].l(e);i=w()},m(e,s){for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,s);S(e,i,s),r=!0},p(e,s){s&278&&(o=V(e[4]),R(),t=te(t,s,l,1,e,o,a,i.parentNode,re,H,i,F),Q())},i(e){if(!r){for(let s=0;s<o.length;s+=1)_(t[s]);r=!0}},o(e){for(let s=0;s<t.length;s+=1)y(t[s]);r=!1},d(e){e&&$(i);for(let s=0;s<t.length;s+=1)t[s].d(e)}}}function me(n){let t,a,i;return t=new ue({props:{cluster:n[16]}}),{c(){D(t.$$.fragment),a=J()},l(r){L(t.$$.fragment,r),a=K(r)},m(r,o){U(t,r,o),S(r,a,o),i=!0},p(r,o){const l={};o&16&&(l.cluster=r[16]),t.$set(l)},i(r){i||(_(t.$$.fragment,r),i=!0)},o(r){y(t.$$.fragment,r),i=!1},d(r){r&&$(a),I(t,r)}}}function H(n,t){let a,i,r;return i=new fe({props:{url:t[8](t[16]),class:"contents",$$slots:{default:[me]},$$scope:{ctx:t}}}),{key:n,first:null,c(){a=w(),D(i.$$.fragment),this.h()},l(o){a=w(),L(i.$$.fragment,o),this.h()},h(){this.first=a},m(o,l){S(o,a,l),U(i,o,l),r=!0},p(o,l){t=o;const e={};l&16&&(e.url=t[8](t[16])),l&524304&&(e.$$scope={dirty:l,ctx:t}),i.$set(e)},i(o){r||(_(i.$$.fragment,o),r=!0)},o(o){y(i.$$.fragment,o),r=!1},d(o){o&&$(a),I(i,o)}}}function ge(n){let t,a,i,r,o;a=new se({props:{queries:n[3],description:n[5]("description"),question:n[5]("research_question")}});let l=n[0]&&G(n);return{c(){t=A("div"),D(a.$$.fragment),i=J(),r=A("div"),l&&l.c(),this.h()},l(e){t=M(e,"DIV",{class:!0});var s=N(t);L(a.$$.fragment,s),i=K(s),r=M(s,"DIV",{class:!0});var c=N(r);l&&l.l(c),c.forEach($),s.forEach($),this.h()},h(){O(r,"class","container p-s grid-1-s s:grid-2-s xl:grid-3-s xxl:grid-4-s svelte-1bhb5im"),O(t,"class","page l:flex-start-start")},m(e,s){S(e,t,s),U(a,t,null),T(t,i),T(t,r),l&&l.m(r,null),o=!0},p(e,[s]){const c={};s&8&&(c.queries=e[3]),a.$set(c),e[0]?l?(l.p(e,s),s&1&&_(l,1)):(l=G(e),l.c(),_(l,1),l.m(r,null)):l&&(R(),y(l,1,1,()=>{l=null}),Q())},i(e){o||(_(a.$$.fragment,e),_(l),o=!0)},o(e){y(a.$$.fragment,e),y(l),o=!1},d(e){e&&$(t),I(a),l&&l.d()}}}function _e(n,t,a){let i,r,o,l,e,s,c,g;const W=ae("tiktok");let m,f,v=!1,C=B("query");j(n,C,u=>a(1,c=u));let E=B("lang");j(n,E,u=>a(2,g=u));const X=async(u=(h=>(h=Object.keys(P))==null?void 0:h[0])())=>{var d;if(v||!oe)return;v=!0;const{data:b,error:p}=await ie({key:`tiktok-${u}-data`,url:e,type:"text"});b?(a(9,f=ne(b)),m!=null&&m.length||(a(3,m=[]),f.forEach(k=>{m.find(q=>q.slug===k.querySlug)||m.push({slug:k.querySlug,title:k.query})}),m.sort((k,q)=>k.title.localeCompare(q.title)||k.queryLabel.localeCompare(q.queryLabel)),c||z(C,c=(d=m[0])==null?void 0:d.slug,c),g||z(E,g=u,g))):a(9,f=null),v=!1},Y=u=>{const h=u==null?void 0:u[0];return`/tiktok/${g}/${c}/${h}`};return n.$$.update=()=>{var u,h,b;n.$$.dirty&518&&a(0,i=(f==null?void 0:f.length)&&c&&g),n.$$.dirty&4&&a(11,r=((u=P)==null?void 0:u[g])||((h=P)==null?void 0:h.us)),n.$$.dirty&514&&a(10,o=(b=f==null?void 0:f.filter)==null?void 0:b.call(f,p=>(p==null?void 0:p.querySlug)===c)),n.$$.dirty&2048&&a(12,l=`${pe}/assets/tiktok/${r==null?void 0:r.code}`),n.$$.dirty&6144&&(e=r?`${l}/clusters_${r.code}.csv`:null),n.$$.dirty&2048&&X(r==null?void 0:r.code),n.$$.dirty&1025&&a(4,s=i?le(o,p=>p.cluster).map(p=>(p[2]=[...new Set(p[1].map(d=>d.ids.split("|")).flat())].length,p)).sort((p,d)=>ce(p[2],d[2])):[])},[i,c,g,m,s,W,C,E,Y,f,o,r,l]}class Se extends x{constructor(t){super(),ee(this,t,_e,ge,Z,{})}}export{Se as component};
